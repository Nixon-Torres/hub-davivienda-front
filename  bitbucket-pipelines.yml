#for your build environment.
#image: qdata/qciagent
image: qdata/qciagent:master-php7

pipelines:
    branches: #The branch section is a container for all branch-specific pipelines
        master:
            - step:
                script:
                - export HOST="ftp.ord1-1.websitesettings.com"
                - export TARGETFOLDER="/web/content/"
                - export SOURCEFOLDER='dist/hub-contenidos-front'
                - export FTPUSER=$PRODFTPUSER
                - export FTPPSWD=$PRODFTPPASS
                - npm install
                - npm install -g @angular/cli
                - ng build --prod --aot=true --buildOptimizer=true
                - /bin/bash /deploy.bash
                - echo "In Stage Branch"


        stage:
            - step:
                script:
                    - export HOST="ftp.ord1-1.websitesettings.com"
                    - export TARGETFOLDER="/web/content/"
                    - export SOURCEFOLDER='dist/hub-contenidos-front'
                    - export FTPUSER=$STGFTPUSER
                    - export FTPPSWD=$STGFTPPASS
                    - npm install
                    - npm install -g @angular/cli
                    - ng build --prod --aot=true --buildOptimizer=true
                    - /bin/bash /deploy.bash
                    - echo "In Stage Branch"
        hub-pro:
            - step:
                script:
                    - apt-get update # required to install zip
                    - apt-get install -y zip # required for packaging up the application
                    - pip install boto3 # required for codedeploy_deploy.py
                    - npm install
                    #- bower install --allow-root
                    - npm run build --prod
                    - chmod +x scripts/*
                    - export DEPLOYMENT_GROUP_NAME=$PRO_DEPLOYMENT_GROUP_NAME
                    - export AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID1
                    - export AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY1
                    - export APPLICATION_NAME=$APPLICATION_NAME_PRO
                    - export S3_BUCKET=$S3_BUCKET_PRO
                    - zip -r /tmp/artifact.zip * # package up the application for deployment
                    - python codedeploy_deploy.py # run the deployment script

    default:
        - step:
            script:
                - echo "Running on the default job"


